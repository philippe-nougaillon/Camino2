<h1>Tables</h1>

<% unless @tables.any? %>
  <i><small>Créez une table de données pour collecter des informations complémentaires aux projets. Ces données pourront être saisie à tout moment où lors de la clôture d'une opération.</small></i> 
  <br><br>
<% end %>

<% if @tables.any? %>
  <table class="table">
    <thead>
      <tr>
        <th>Nom</th>
        <th>Attributs</th>
        <th>Utilisée par les projets</th>
        <th>Nbr enregistrements</th>
        <th>Dernière mise à jour</th>
        <th colspan="2"></th>
      </tr>
    </thead>

    <tfoot>
      <tr>
        <td /><td /><td /><td /><td /><td /><td /><td />
      </tr>
    </tfoot>

    <tbody>
      <% @tables.each do |table| %>
        <tr>
          <td><b><%= link_to table.name, table %></b></td>
          <td>
            <%= link_to table.fields.count, table_path(table, attrs:1), 
                    title:"#{table.fields.any? ? "Modifier les" : "Ajouter des"} attributs: #{table.fields.pluck(:name).join(", ")}" %>
          </td>
          <td>
              <% table.projects.order(:name).each do |p| %>
                <% if p.color %>
                  <span style="background-color:<%= p.color %>;padding-left:5px;margin-left:5px;margin-right:5px;"> </span>
                <% else %>
                  |
                <% end %>
                <% if p.participants.where(user_id:session[:user_id]).any? %>
                  <%= link_to p.name, project_path(p) %>
                <% else %>
                  <%= p.name %>
                <% end %>
              <% end %>
          </td>
          <td><%= table.size %></td>
          <td style="color:lightgray;"><%= "Il y a #{time_ago_in_words(table.values.maximum(:updated_at))}" if table.values.any? %>
          <td>
              <%= link_to_if table.values.any?,image_tag('excel_logo.png', size:'25x25'), table_path(table, format:'xls'), title:'Export Excel' %>
          </td>
          <td><%= link_to image_tag("modif.png"), table_path(table, attrs:1), title:"Modifier les attributs de la table" %></td>
          <td><%= link_to '[X]', table, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <br>
<% end %>

<%= link_to 'Nouvelle Table', new_table_path %>
