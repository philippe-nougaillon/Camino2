<div>
  <h1 class="font-bold text-4xl mb-6">Admin</h1>

  Audited : <%= @total_audit %> lignes

  <div class='overflow-x-auto mt-6'>
    <table class='table'>
      <thead>
        <tr>
          <th>Derni√®re Connexion</th>
          <th>Dernier Changement</th>
          <th>Nb Connexions</th>
          <th>Email</th>
          <th>Account</th>
          <th>Projets</th>
          <th>Nb lignes</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @users.each do |user| %>
          <% account = user.account %>
          <% participant_count = User.where(id: account.users).count %>
          <% last_change = Audited::Audit.where(user_id: user.id).last %>
          <% if account.users.first == user %>
            <% total_lignes = account_infos(account) %>
          <% end %>
          <tr>
            <td><%= time_ago_in_words user.last_sign_in_at if user.sign_in_count.positive? %></td>
            <td><%= time_ago_in_words last_change.created_at if last_change %></td>
            <td class=" <%= user.sign_in_count > 1 ? 'text-info font-black' : ''  %>"><%= user.sign_in_count %></td>
            <td><%= user.email %></td>
            <td class=<%= 'text-info' if participant_count > 1 %>><%= account.name %> (<%= participant_count %> users)</td>
            <% if account.users.first == user %>
              <td class=<%= 'text-info' if account.projects.count > 1 %>><%= account.projects.count %></td>
              <td class=<%= 'text-info' if total_lignes > 32 %>><%= total_lignes %></td>
              <td><%= link_to "[X]", admin_suppression_compte_path(account:), class:"btn btn-ghost btn-sm" %></td>
            <% else %>
              <td colspan=3></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <span><%= page_entries_info @users, entry_name: 'user' %></span>
  <%= paginate @users %>


</div>
