<h1 class="mb-6">
  Projets
  <%= link_to new_project_path, title:'Ajouter un projet' do %>
    <div class="badge badge-outline rounded badge-lg">+</div>
  <% end %>
</h1>

<% if @tags.any? %>
  Tags:
  <% tag_cloud(@tags, ['badge badge-lg', 'badge badge-md', 'badge', 'badge badge-sm']) do |tag, css_class| %>
    <%= link_to(tag.name, projects_path(tag:tag.name), class: css_class) %>
  <% end %>
  <br><br>
<% end %>

<% if @projects.any? %>
  <div class="overflow-x-auto">
    <table class="table table-normal">
      <thead>
        <tr>
          <th />
          <th />
          <th>Echéance</th>
          <th>Progression</th>
          <th>Phase en cours</th>
          <th>Participants</th>
          <th>Dernière mise à jour</th>
        </tr>
      </thead>

      <tbody>
        <% @projects.each do |project| %>
          <tr class="hover">
            <td style="background-color:<%= project.color %>;padding-left: 1px;"></td>
            <td>
              <%= link_to project.name, project, class: 'bold-title' %>
              <br>
              <i><small><%= truncate(project.description, length: 100) %></small></i>
            </td>
            <td><%= l(project.duedate) if project.duedate %></td>
            <td>
              <% unless project.todos.count.zero? %>
                <%= raw project.bar_avancee %>
                <small>(<%= project.pct_avancee %>%)</small>
              <% end %>
            </td> 
            <td>
              <% if project.workflow? and project.current_todolist %>
                <small><%= truncate(project.current_todolist.name, length: 15) %></small>  
              <% end %>
            </td>
            <td>
              <% project.participants.each do |participant| %>
                <%# image_tag url_for(participant.user.avatar), size:'15x15', alt:'', title:"#{participant.user.name} #{participant.client ? "(Client)":""}", class:"mini_avatar" %>
                <%= "#{participant.user.name} #{participant.client ? "(Client)":""}" %>
              <% end %>
              <%= link_to invite_path(id:project.id), title:'Inviter un nouveau participant' do %>
                <div class="badge badge-outline rounded badge-lg">+</div>
              <% end %>
            </td>
            <td style="color:lightgrey"><%= "Il y a #{time_ago_in_words(project.last_update)}" if project.logs.any? %></td>
          </tr>
          <tr />  
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <% unless params[:search].blank? %>
    <i>Aucun projet à afficher...</i>
  <% else %>
    <i>
      Vous ne participez à aucun projet actuellement. Cliquez sur  
      <%= link_to new_project_path do %>
        <div class="badge badge-outline rounded badge-lg">+</div>
      <% end %>
      pour ajouter un projet.
    </i>
  <% end %>
  <br>
<% end %>


<% if @logs.any? %>
  <br>
  <hr class="style-two">
  <h2 class="mt-6">
    Activité
  </h2>
  <table id="logs">
    <%= render partial:'logs/log', collection:@logs, day:0, user_id:0 %>
  </table>
  <br>
  <% if @logs.count >= 5 %>  
    <small><i>Liste des 5 derniers changements. <%= link_to "Afficher tout", logs_path %></i></small>
    <br>
  <% end %>
  <br>
<% end %>


<% if @comments.any? %>
  <hr class="style-two">
  <h3>Discussions</h3>
  <table id="logs">
    <%= render partial:'comments/commentfull', collection:@comments, as: :comment, comment_day:0, user_id:0  %>
  </table>
  <br>
  <% if @comments.count >= 5 %>
    <small><i>Liste des 5 derniers commentaires. <%= link_to "Afficher tout", comments_path %></i></small>
    <br>
  <% end %>
  <br>
<% end %>
